# OpenIM Admin New Front 2 反向代理配置文件
# 代理到 47.83.254.218 服务器

# 管理后台服务 (端口 10009)
upstream admin_backend_2 {
    server 47.83.254.218:10009;
}

# 用户服务 (端口 10008)
upstream user_backend_2 {
    server 47.83.254.218:10008;
}

# IM 系统服务 (端口 10002)
upstream im_backend_2 {
    server 47.83.254.218:10002;
}

server {
    listen 80;
    server_name localhost;
    
    # 客户端最大请求体大小
    client_max_body_size 100M;
    
    # 代理超时设置
    proxy_connect_timeout 60s;
    proxy_send_timeout 60s;
    proxy_read_timeout 60s;
    
    # 通用代理头设置
    proxy_set_header Host $host;
    proxy_set_header X-Real-IP $remote_addr;
    proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
    proxy_set_header X-Forwarded-Proto $scheme;
    
    # ==================== 管理后台服务 (端口 10009) ====================
    # 管理后台相关接口 - /api/admin/*
    location /api/admin {
        proxy_pass http://admin_backend_2;
        rewrite ^/api/admin(.*)$ $1 break;
    }
    
    # ==================== 用户服务 (端口 10008) ====================
    # 用户服务相关接口 - /api/user/*
    location /api/user {
        proxy_pass http://user_backend_2;
        rewrite ^/api/user(.*)$ $1 break;
    }
    
    # ==================== IM 系统服务 (端口 10002) ====================
    # IM 系统相关接口 - /api/im/*
    location /api/im {
        proxy_pass http://im_backend_2;
        rewrite ^/api/im(.*)$ $1 break;
    }
    
    # ==================== 静态文件服务 ====================
    # 前端静态文件
    location / {
        root /usr/share/nginx/html;
        index index.html index.htm;
        try_files $uri $uri/ /index.html;
    }
    
    # 错误页面
    error_page 500 502 503 504 /50x.html;
    location = /50x.html {
        root /usr/share/nginx/html;
    }
}
